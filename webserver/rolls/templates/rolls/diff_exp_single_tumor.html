{%extends 'rolls/layoutpagine.html' %}
{%load crispy_forms_tags%}
{%block content%}
{% load static %}

  <h2>Differential expression analysis</h2>
      <p>
        <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapsedescription" role="button" aria-expanded="false" aria-controls="collapsedescription">
          Description
        </a>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
          Example
        </button>
      </p>
      <div class="collapse" id="collapsedescription">
        <div class="card card-body">
          <h4>Single-gene differential expression analysis</h4>
          <p>Single-gene differential expression analysis is an analysis that allows the user to study the difference in expression of a gene, miRNA or protein between patients in two different conditions (based on the selected feature) with a given tumor.
            <br>This analysis uses TCGA Gene Expression Quantification - FPKM data (normalized counts) for genes.
            <br><br><i class="fa-solid fa-square-poll-horizontal"></i> As a result of the analysis, a box-plot is returned showing on the x-axis the two conditions under consideration (e.s. male and female), while the y-axis shows the expression of the gene, miRNA or protein entered.
            <br>Finally, the p-value is calculated using the Wilcoxon test, which indicates the significance of difference in expression between the two groups examined. 
          </p>
            <hr>
            
            <h4>miRNA isoform interactor analysis</h4>
            <p>This analysis provides the ability for the user to analyze the expression profile of the interactors of miRNA isoforms. 
            <br>The implemented script checks whether that provided miRNA has isoforms that are present in the RNA inter interaction file. This file contains the information of all miRNA (isoforms) - mRNA interactions
            that have been experimentally validated belonging to Homo sapiens. 
            </p>
            <br>
            The result obtained is a cluster map. On the rows the names of the patients and on the columns the name of the genes interacting with the miRNA isoform.
            Clustering was performed to highlight groups of genes with similar expression profile.



          </p>
        </div>
      </div>
        
      <div class="row my-3">
          <div class="col-sm-3 my-3">
              <form method="post" >
                  {%csrf_token%}
                  {{form|crispy}}
                  <br>
                  <div class="d-grid gap-2 d-md-flex justify-content-md">
                      <button class="btn btn-primary me-md-2 my-3" type="submit">Submit</button>
                  </div>
              
              </form>
          </div>
              <div class="col mx-3" style="border:1px; border-left-style: solid; border-color:rgba(0, 0, 128, 0.301)">
                <div class="collapse" id="collapseExample">
                  <div class="card card-body">
                    <p class="text-center" >Example: </p>
                    <img src= "{%static 'media/examples/de_heatmap.png' %}" width="750">
                  </div> 
                </div>
                  {%if go == 'Valid' %}
                  
                  <h3>Results:</h3> 
                  <hr>
                  <p><b>Tumor: </b>{{tumor}}</p>
                  <p><b>Feature: </b>{{feature}}</p>
                  <p><b>Gene: </b> {{gene}}</p>
                
                  <p><b>P-value: </b>{{formresult}}</p>
                  <br><br>
                  <div class="row">
                    <div class="zoom col shadow mb-3 bg-body rounded" style="max-width: 450px;">
                      <a href="{%static image%}" target="_blank"><img src= '{%static image %}' width="400"></a>
                  </div>
                  
                  {%endif%}

                  {%if go == 'Valid_heat' %}
                  
                  <h3>Results:</h3> 
                  <hr>
                  <p><b>Tumor: </b>{{tumor}}</p>
                  <p><b>Feature: </b>{{feature}}</p>
                  <p><b>Gene: </b> {{gene}}</p>
                
                  <p><b>P-value: </b>{{formresult}}</p>
                  
                  <br><br>
                  <div class="row">
                    <div class="zoom col shadow mb-3 bg-body rounded" style="max-width: 450px;">
                      <a href="{%static image_box%}" target="_blank"><img src= '{%static image_box%}' width="400"></a>
                    </div>
                  </div>
                  <hr>
                    <h5>Interactor analysis of miRNA isoforms <a href="{{dir}}/result.txt" download target="blank" ><button class="btn"> Download results <i class="fa-solid fa-download"></i></button></a></h5>
                  
                    {% for img in image_cluster%}
                    <div class="zoom col shadow mb-3 bg-body rounded" style="max-width: 450px;">
                      <a href="{%static img%}" target="_blank"><img src= '{%static img %}' width="400"></a>
                    </div>
                  {%endfor%}
                  

                  {%endif%}
                 
               

                  {%if go == 'error'%}
                  <div class="alert alert-danger text-center" role="alert">
                    <h5>Non esistono risultati per {{gene}} - {{tumor}} - {{feature}}</h5>
                    <p> Errore </p>
                  </div> 

                  {%endif%}

                  {%if go == 'errorname' %}
                  <div class="alert alert-danger text-center" role="alert">
                    <h5>Non esistono risultati per "{{gene}}"</h5>  
                  </div> 
                  {%endif%}
           
            
              
            </div>
              </div>
      </div>
      

{%endblock%}
    
