{%extends 'rolls/layoutpagine.html' %}
{%load crispy_forms_tags%}
{%block content%}
{% load static %}
<h4 style="color:navy">Survival Analyses</h4>
  <h2> Overall survival </h2>
      <p>
        <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapsedescription" role="button" aria-expanded="false" aria-controls="collapsedescription">
          Description
        </a>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
          Example
        </button>
      </p>
      <div class="collapse" id="collapsedescription">
        <div class="card card-body">
          <!-- <h4>Analysis of overall survival</h4>
          <p>Time is shown on the x-axis, and survival probability (conditional probability) is shown on the y-axis. 
          <br>The implemented script uses OS time data provided by TCGA in the clinical data file as time-to-event information.
          <br>The time data are expressed in days. 
          <br><br>The expression data used are Gene Expression Quantification HTSeq - FPKM, miRNA Expression Quantification and Protein Expression Quantification.
        </p> -->
        
        <p>The analysis presented involves the investigation of overall survival (OS) data using Kaplan-Meier survival curves and log-rank tests to evaluate the association between gene, miRNA, and protein expression levels with patient outcomes. Specifically, OS data provided by The Cancer Genome Atlas (TCGA) is used as time-to-event information. The survival time, expressed in days, measures the duration from diagnosis or treatment initiation until the event of interest, such as death or last follow-up.</p>
        <p>The expression data used are Gene Expression Quantification HTSeq - FPKM, miRNA Expression Quantification and Protein Expression Quantification</p>
    
        <p>The analysis consists of several key components:</p>
        <p><b>1. Kaplan-Meier Survival Curves:</b> Kaplan-Meier estimators are used to compute the survival probabilities over time for patients stratified by their expression levels. For each gene, miRNA, or protein, patients are divided into two groups: those with expression levels above the median (higher expression) and those below the median (lower expression). The survival curves for each group are plotted to visualize differences in survival probabilities over time.</p>
    
        <p><b>2. Log-Rank Test:</b> To statistically compare the survival distributions between the higher and lower expression groups, the log-rank test is employed. This test assesses whether there are significant differences in overall survival between the two groups, with the resulting p-value indicating the level of statistical significance.</p>
        <p><b>3. Survival Time in Days:</b> The x-axis of the Kaplan-Meier plot represents the time in days, reflecting the OS data. The y-axis displays the survival probability, which represents the conditional probability of surviving beyond a given time point.</p>
        <p><b>4. Expression Level Impact on Survival:</b> By linking the OS data to gene, miRNA, and protein expression levels, this analysis aims to identify potential biomarkers of survival, providing insights into the biological mechanisms driving cancer progression and patient prognosis.</p>

        <br>
        <p>This integrative approach combining transcriptomic, proteomic, and survival data allows for a comprehensive assessment of how molecular alterations impact patient outcomes, potentially guiding personalized cancer therapies and improving prognostic predictions.</p>

        </div>
      </div>
        
      <div class="row my-3">
          <div class="col-sm-3 my-3">
              <form method="post" >
                  {%csrf_token%}
                  {{form|crispy}}
                  <br>
                  <div class="d-grid gap-2 d-md-flex justify-content-md">
                      <button class="btn btn-primary me-md-2 my-3" type="submit">Submit</button>
                  </div>
              
              </form>
          </div>
              <div class="col mx-3" style="border:1px; border-left-style: solid; border-color:rgba(0, 0, 128, 0.301)">
                <div class="collapse" id="collapseExample">
                  <div class="card card-body">
                    <p class="text-center" >Example: </p>
                    <img src= "{%static 'media/examples/os.png' %}" width="600">
                  </div> 
                </div>
                  {%if go == 'Valid' %}
                
                  <h3>Results: </h3>
                  <hr>
                  <p>Gene: {{gene}}</p>
                  <p>Tumor: {{tumor}}</p>
                  <p>Method: {{method}}</p>
                  {{formresult}}
                  <div class="row">
                   
                    <div class="mb-3 bg-body rounded" style="max-width: 500px;text-align: center;">
                      <a href="{%static image%}" target="_blank"><img src= '{%static image %}' width="700"></a>
                  </div>
                  </div>
                </div>
                  {%endif%}
                  
                  {%if go == "error" %}
                  <div class="alert alert-danger text-center" role="alert">
                    <h5>There are no results for {{gene}} - {{tumor}}</h5>
                    {{formresult}}
                  </div> 
                  {%endif%}

           
            
              
            </div>
      
      </div>
      
<!-- Includi jQuery UI e il suo CSS -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<!-- Script per il suggerimento con jQuery UI -->
<script type="text/javascript">
  $(document).ready(function() {
    $('#gene-input').autocomplete({
      source: function(request, response) {
        $.ajax({
          url: "{% url 'gene_suggestions' %}",  // L'URL che abbiamo aggiunto
          data: {
            'term': request.term  // Il testo digitato dall'utente
          },
          success: function(data) {
            response(data);  // Restituisci i risultati all'autocomplete
          }
        });
      },
      minLength: 1,  // Numero minimo di caratteri per avviare l'autocomplete
    });
  });
</script>

{%endblock%}
    
